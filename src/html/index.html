<!doctype html><html><head><script type="text/javascript">





function default_formatter(item) {
  const pre     = document.createElement('pre');
  pre.innerHTML = JSON.stringify(item, undefined, 2);
  return pre;
}





function make_repl({evaluator, target, logger, formatter, r}) {

  const uTarget    = target    || document.body,
        uFormatter = formatter || default_formatter,
        uLogger    = logger    || function (item) { uTarget.appendChild(uFormatter(item)); },
        uEval      = evaluator || eval;

  // history
  let h = [];

  // loop until blank input or cancel
  // print last 10 reults

  while (s = prompt(JSON.stringify(h.slice(-10)))) {

    // eval the input, coerce to string, push onto history
    // TODO: JSON.stringify() or other pretty printing?

    try {
      r = uEval(s);
    } catch (e) {
      r = e;
    }

    h.push({ query: s, result: r });
    uLogger(r);

  }

}





window.onload = function() { make_repl({}); }

</script></head><body></body></html>
